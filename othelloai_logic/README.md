# Othello AI Logic

このディレクトリには、C++で実装されたオセロAIのコアロジックが含まれています。
GUIアプリケーションから呼び出されることを想定した、高速なビットボード/インデックスベースの処理系です。

## 📂 File Structure

### [othello.cpp](othello.cpp)
ゲームのメインプログラムです。
- ユーザーインターフェース（CUI）とゲームループを管理します。
- プレイヤー（人間）とAIの手番を制御し、勝敗を決定します。
- **主な関数**:
    - `main`: ゲームの進行管理。
    - `print`: コンソールへの盤面表示。
    - `init_game`: ゲームの初期化。

### [board.hpp](board.hpp)
オセロの盤面状態を管理するヘッダーファイルです。
- **特徴**: 高速化のため、盤面を特定のインデックス（3進数表現など）で管理し、事前計算されたテーブルを用いて合法手判定や石の反転を定数時間に近い処理で行います。
- **主な機能**:
    - `legal_place`: 合法手の判定。
    - `move`: 着手処理と石の反転。
    - `init_board`: 遷移テーブルの初期化。

### [ai1.cpp](ai1.cpp)
AIの思考ルーチン（探索部）です。
- **アルゴリズム**: **Nega-alpha法**（Minimax法の改良版、Alpha-Beta法と同等）を採用しています。
- 指定された深さまで先読みを行い、最善の手を返します。
- **主な関数**:
    - `search`: 探索のルート関数。
    - `nega_alpha`: 再帰的な探索関数。

### [cell_evaluate.hpp](cell_evaluate.hpp)
盤面の評価関数です。
- **手法**: **位置重み付け評価**（Static Evaluation）。
- 盤面の各マスに予め決められた点数（四隅は高く、その周辺は低くなど）を割り当て、現在の盤面のスコアを算出します。
- **主な機能**:
    - `evaluate`: 現在の盤面の評価値を計算。
    - `evaluate_init`: 評価テーブルの初期化。

## 🛠 Dependencies

- 標準C++ライブラリ (`<iostream>`, `<stdio.h>`, `<string>`)
- 各ファイルは相互に依存しています（`othello.cpp` が他をインクルード）。

## 🚀 Usage

```bash
# ビルド
g++ othello.cpp -o othello

# 実行 (APIモード)
./othello [board_string] [turn]
```

- **board_string**: 盤面64マスの状態を表す文字列。
  - `0`: 黒石
  - `1`: 白石
  - `2`: 空き
  - 左上(A1)から右下(H8)への順序。合計64文字。
- **turn**: 手番。
  - `0`: 黒番
  - `1`: 白番
- **出力**:
  - 次の一手のインデックス（0〜63）。

```mermaid
graph TD
    Main[othello.cpp<br>メイン進行・UI] --> |盤面操作| Board[board.hpp<br>盤面ロジック・高速化]
    Main --> |思考依頼| AI[ai1.cpp<br>探索アルゴリズム]
    AI --> |先読み| Board
    AI --> |局面評価| Eval[cell_evaluate.hpp<br>評価関数]
    Eval --> |盤面参照| Board
```

### 🔄 実行の流れ（AIの手番）

1. **思考開始 (`othello.cpp`)**: 
   - AIの手番が来ると、`othello.cpp` が `search(b, 10)` を呼び出し、現在の盤面 `board b` を渡して「10手読み」を依頼します。

2. **探索 (`ai1.cpp`)**: 
   - `search` 関数から `nega_alpha` 関数（再帰探索）に入ります。
   - ネガアルファ法により、「自分は最善手（得する手）、相手も最善手（自分を損させる手）」を選び続けると仮定して、ゲーム木を展開します。

3. **盤面シミュレーション (`board.hpp`)**: 
   - AIが未来の盤面を予測する際、`b.move()` を頻繁に呼び出します。
   - `board.hpp` は、事前計算されたテーブル（遷移テーブル）を参照し、石を裏返す処理を高速に行います。ループ計算ではなく配列参照で処理するため、大量の探索が可能になります。

4. **評価 (`cell_evaluate.hpp`)**: 
   - 探索の深さが指定（10手）に達すると、`evaluate(b)` が呼ばれます。
   - 盤面の各マスに設定された重み（`cell_weight`）に基づき、「現局面の有利度」を数値化して返します（角は高得点、危険地帯は減点など）。

5. **決定 (`othello.cpp`)**: 
   - 全ての候補手を調べ終えると、最も評価値が高かった手が `main` 関数に返され、実際に石が置かれます。

## ⚖️ ルートディレクトリ版（v2.0）との比較

ルートディレクトリに追加された新しいファイル群（`othello.cpp`, `ai1.cpp` 等）は、このフォルダ内のコードよりも高度な実装がなされています。主な違いは以下の通りです。

### 1. AIアルゴリズムの強化 (`ai1.cpp`)
ルート版のAIは、以下の技術により探索能力が大幅に向上しています。

- **置換表 (Transposition Table)**: 
    - 一度計算した盤面の評価値をメモリ（ハッシュマップ）に保存し、再利用します。これにより、手順が違っても同じ局面になった場合の無駄な再計算を防ぎます。
- **ムーブオーダリング (Move Ordering)**: 
    - 「以前に良かった手」や「置換表にある手」から優先的に探索します。これにより、ネガアルファ法の枝刈り（カット）が効率よく発生し、同じ時間でより深く読めるようになります。
- **反復深化 (Iterative Deepening)**: 
    - いきなり指定された深さを探索するのではなく、浅い探索（例: 2手読み）から始めて徐々に深くしていきます。これにより、時間切れになった場合でも「これまでの最善手」を返すことが可能になります。

### 2. パフォーマンスと最適化 (`board.hpp`)
- **Move Ordering用の評価**: 
    - 通常の評価関数とは別に、探索順序を決めるための軽量な評価ロジックが追加されています。
- **ハッシュ関数**: 
    - 盤面状態を一意な数値（ハッシュ値）に変換する機能が追加され、置換表での高速な検索を可能にしています。

### 3. インターフェースの変更
- **`othello.cpp` / `search`**: 
    - `search(b, 9, 3)` のように、反復深化のためのパラメータ（深さとオフセット）を受け取る形に変更されています。